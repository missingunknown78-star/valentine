<!DOCTYPE html>
<html>
<head>
    <title>Add Instructor üíñ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #fff5f7 0%, #ffe6f0 100%);
            color: #2d3748;
            line-height: 1.5;
            min-height: 100vh;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 1rem;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        h1 {
            font-size: 1.8rem;
            color: #ff4d6d;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(255, 77, 109, 0.1);
        }

        .subtitle {
            color: #718096;
            font-size: 0.9rem;
        }

        /* Form Card */
        .form-card {
            background: white;
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(255, 77, 109, 0.1);
            margin-bottom: 1.5rem;
        }

        /* Form Groups */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #ff4d6d;
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 0.5rem;
        }

        .label-icon {
            font-size: 1.2rem;
        }

        .form-group input[type="text"] {
            width: 100%;
            padding: 0.9rem 1rem;
            border: 2px solid #ffe6f0;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #fff;
        }

        .form-group input[type="text"]:focus {
            outline: none;
            border-color: #ff4d6d;
            box-shadow: 0 0 0 3px rgba(255, 77, 109, 0.1);
        }

        .input-hint {
            display: block;
            color: #a0aec0;
            font-size: 0.75rem;
            margin-top: 0.3rem;
        }

        /* Color Picker */
        .color-group {
            margin-bottom: 2rem;
        }

        .color-picker-wrapper {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            background: #fff5f7;
            padding: 0.5rem;
            border-radius: 12px;
            border: 2px solid #ffe6f0;
        }

        input[type="color"] {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            background: transparent;
        }

        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }

        input[type="color"]::-webkit-color-swatch {
            border: 2px solid white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .color-value {
            font-family: monospace;
            font-size: 1rem;
            color: #ff4d6d;
            font-weight: 600;
        }

        /* QR Generator Section */
        .qr-generator-section {
            background: #fff5f7;
            border-radius: 16px;
            padding: 1.2rem;
            margin-bottom: 2rem;
            border: 2px dashed #ff4d6d;
        }

        .qr-generator-section h3 {
            color: #ff4d6d;
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .qr-description {
            color: #718096;
            font-size: 0.85rem;
            margin-bottom: 1.2rem;
        }

        /* QR Preview */
        .qr-preview-container {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            margin-bottom: 1rem;
            min-height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .qr-placeholder {
            color: #a0aec0;
        }

        .qr-icon {
            font-size: 3rem;
            display: block;
            margin-bottom: 0.5rem;
        }

        .qr-placeholder p {
            font-size: 0.9rem;
        }

        .qr-image-container img {
            max-width: 150px;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        /* Generate Button */
        .btn-generate {
            width: 100%;
            background: linear-gradient(135deg, #9f7aea 0%, #b794f4 100%);
            color: white;
            border: none;
            padding: 0.9rem;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 4px 10px rgba(159, 122, 234, 0.3);
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        .btn-generate:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(159, 122, 234, 0.4);
        }

        .btn-generate:active {
            transform: translateY(0);
        }

        .btn-generate:disabled {
            opacity: 0.7;
            transform: none;
            cursor: not-allowed;
        }

        .btn-icon {
            font-size: 1.2rem;
        }

        /* QR Info */
        .qr-info {
            background: #c6f6d5;
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .qr-info p {
            color: #22543d;
            font-size: 0.9rem;
            margin-bottom: 0.3rem;
        }

        .url-preview {
            background: white;
            padding: 0.7rem;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.7rem;
            word-break: break-all;
            color: #22543d;
            border: 1px solid #9ae6b4;
            margin: 0.5rem 0;
        }

        .success-message {
            font-weight: 600;
            color: #22543d;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        /* QR Error */
        .qr-error {
            background: #fed7d7;
            color: #742a2a;
            padding: 0.8rem;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-top: 0.8rem;
        }

        /* Form Actions */
        .form-actions {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .btn-submit {
            background: linear-gradient(135deg, #ff4d6d 0%, #ff8aa1 100%);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.8rem;
            box-shadow: 0 4px 10px rgba(255, 77, 109, 0.3);
            transition: all 0.3s ease;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(255, 77, 109, 0.4);
        }

        .btn-submit:active {
            transform: translateY(0);
        }

        .btn-submit:disabled {
            opacity: 0.7;
            transform: none;
            cursor: not-allowed;
        }

        .btn-back {
            background: white;
            color: #ff4d6d;
            text-decoration: none;
            padding: 0.9rem;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            border: 2px solid #ff4d6d;
            transition: all 0.3s ease;
        }

        .btn-back:hover {
            background: #fff5f7;
            transform: translateY(-2px);
        }

        .btn-back:active {
            transform: translateY(0);
        }

        /* Footer */
        footer {
            text-align: center;
            color: #718096;
            font-size: 0.8rem;
            margin-top: 2rem;
        }

        /* Tablet and up */
        @media (min-width: 640px) {
            .container {
                max-width: 600px;
                margin: 0 auto;
                padding: 2rem 1.5rem;
            }

            h1 {
                font-size: 2.2rem;
            }

            .form-actions {
                flex-direction: row;
            }

            .btn-submit, .btn-back {
                flex: 1;
            }

            .qr-image-container img {
                max-width: 180px;
            }
        }

        /* Small phones */
        @media (max-width: 380px) {
            .form-card {
                padding: 1.2rem;
            }

            h1 {
                font-size: 1.5rem;
            }

            .color-picker-wrapper {
                flex-wrap: wrap;
            }
        }

        /* Safe area insets */
        @supports (padding: max(0px)) {
            .container {
                padding-left: max(1rem, env(safe-area-inset-left));
                padding-right: max(1rem, env(safe-area-inset-right));
            }
        }

        /* Loading animation */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .btn-generate:disabled,
        .btn-submit:disabled {
            animation: pulse 1.5s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Add New Instructor üíò</h1>
            <p class="subtitle">Create a QR code for your instructor</p>
        </header>

        <main>
            <div class="form-card">
                <form method="POST" class="instructor-form" id="instructorForm">
                    <div class="form-group">
                        <label for="name">
                            <span class="label-icon">üë§</span>
                            Instructor Name
                        </label>
                        <input type="text" id="name" name="name" placeholder="e.g., Prof. Valentine" required>
                        <small class="input-hint">Enter the instructor's full name</small>
                    </div>

                    <div class="form-group color-group">
                        <label for="color">
                            <span class="label-icon">üé®</span>
                            Theme Color
                        </label>
                        <div class="color-picker-wrapper">
                            <input type="color" id="color" name="color" value="#ff4d6d">
                            <span class="color-value">#ff4d6d</span>
                        </div>
                        <small class="input-hint">Choose a color for their card</small>
                    </div>

                    <!-- QR Code Generator Section -->
                    <div class="qr-generator-section">
                        <h3>
                            <span>üì±</span>
                            QR Code Generator
                        </h3>
                        <p class="qr-description">Generate a QR code for your instructor to add their Valentine message</p>
                        
                        <div class="qr-preview-container" id="qrPreviewContainer">
                            <div class="qr-placeholder" id="qrPlaceholder">
                                <span class="qr-icon">üì±</span>
                                <p>Click generate to create QR code</p>
                            </div>
                            <div class="qr-image-container" id="qrImageContainer" style="display: none;">
                                <img id="qrPreviewImage" src="" alt="QR Code">
                            </div>
                        </div>
                        
                        <button type="button" class="btn-generate" id="generateQRBtn">
                            <span class="btn-icon">üî≤</span>
                            Generate QR Code
                        </button>

                        <div class="qr-info" id="qrInfo" style="display: none;">
                            <p><strong>Instructor's link:</strong></p>
                            <div class="url-preview" id="urlPreview"></div>
                            <p class="success-message">‚úÖ QR Code ready! Share with instructor.</p>
                        </div>

                        <div class="qr-error" id="qrError" style="display: none;"></div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-submit" id="submitBtn">
                            <span class="btn-icon">üíñ</span>
                            Create Instructor
                        </button>
                        <a href="{{ url_for('admin.dashboard') }}" class="btn-back">
                            <span class="btn-icon">‚Üê</span>
                            Back
                        </a>
                    </div>
                </form>
            </div>
        </main>

        <footer>
            <p>Made with üíñ for Valentine's Day</p>
        </footer>
    </div>

    <script>
        // Elements
        const nameInput = document.getElementById('name');
        const colorInput = document.getElementById('color');
        const colorValue = document.querySelector('.color-value');
        
        // QR Code Elements
        const generateBtn = document.getElementById('generateQRBtn');
        const qrPlaceholder = document.getElementById('qrPlaceholder');
        const qrImageContainer = document.getElementById('qrImageContainer');
        const qrPreviewImage = document.getElementById('qrPreviewImage');
        const qrInfo = document.getElementById('qrInfo');
        const urlPreview = document.getElementById('urlPreview');
        const qrError = document.getElementById('qrError');
        
        // Store generated QR data
        let generatedQRData = null;

        // Update color value display
        colorInput.addEventListener('input', function() {
            colorValue.textContent = this.value;
        });

        // Generate QR Code
        generateBtn.addEventListener('click', function() {
            const name = nameInput.value.trim();
            
            if (!name) {
                alert('Please enter an instructor name first!');
                nameInput.focus();
                return;
            }

            qrError.style.display = 'none';
            
            // Show loading state
            generateBtn.disabled = true;
            generateBtn.innerHTML = '<span class="btn-icon">‚è≥</span> Generating...';

            const baseUrl = window.location.origin;
            const generateUrl = baseUrl + '/valentine/admin/generate-qr-preview';

            fetch(generateUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    name: name
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    qrPreviewImage.src = 'data:image/png;base64,' + data.qr_code;
                    qrPlaceholder.style.display = 'none';
                    qrImageContainer.style.display = 'block';
                    
                    urlPreview.textContent = data.preview_url;
                    qrInfo.style.display = 'block';
                    
                    generatedQRData = data;
                    
                    generateBtn.disabled = false;
                    generateBtn.innerHTML = '<span class="btn-icon">‚úÖ</span> Regenerate QR Code';
                } else {
                    throw new Error(data.error || 'Failed to generate QR code');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                qrError.textContent = 'Error: ' + error.message;
                qrError.style.display = 'block';
                
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<span class="btn-icon">üî≤</span> Generate QR Code';
                
                qrPlaceholder.style.display = 'block';
                qrImageContainer.style.display = 'none';
                qrInfo.style.display = 'none';
            });
        });

        // Form submission
        document.getElementById('instructorForm').addEventListener('submit', function(e) {
            if (!generatedQRData) {
                e.preventDefault();
                alert('Please generate a QR code first!');
                return;
            }
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="btn-icon">‚è≥</span> Creating...';
        });
    </script>
</body>
</html>